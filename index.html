<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISU Excellence Award Voting System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 400;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .instructions {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .warning {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 10px;
        }

        .progress-container {
            margin: 25px 0;
        }

        .progress-bar {
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
        }

        .category-title {
            font-size: 1.6rem;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .candidate-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .candidate-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .candidate-card.selected {
            border-color: #27ae60;
            background-color: #e8f6f3;
        }

        .candidate-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            border: 4px solid #3498db;
            background-color: #ecf0f1;
        }

        .candidate-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .candidate-country {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219653;
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .submit-section {
            text-align: center;
            margin: 30px 0;
            display: none;
        }

        .admin-section {
            margin-top: 40px;
            border-top: 2px dashed #bdc3c7;
            padding-top: 30px;
        }

        .admin-title {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .admin-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .admin-btn {
            background: #9b59b6;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: #8e44ad;
        }

        .admin-btn.view {
            background: #3498db;
        }

        .admin-btn.reset {
            background: #f39c12;
        }

        .admin-btn.clear {
            background: #e74c3c;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-online {
            background: #27ae60;
            color: white;
        }

        .status-offline {
            background: #e74c3c;
            color: white;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .candidates-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .admin-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ISU EXCELLENCE AWARD</h1>
            <h2>Category-Based Voting System 
                <span id="connectionStatus" class="status-badge status-offline">CHECKING...</span>
            </h2>
        </header>

        <div class="card">
            <div class="instructions">
                <p>Vote for ONE candidate in each category. Navigate through categories using Next/Previous buttons.</p>
                <p class="warning"><i class="fas fa-exclamation-triangle"></i> You can only vote once per device!</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">Category 1 of 38</div>
            </div>

            <div id="categoriesContainer">
                <!-- Categories will load here -->
            </div>

            <div class="submit-section" id="submitSection">
                <button class="btn btn-success" id="submitButton" onclick="submitVotes()">
                    <i class="fas fa-paper-plane"></i> Submit All Votes to Google Sheets
                </button>
                <p style="margin-top: 10px; color: #7f8c8d;">
                    You've voted in <span id="votesCount">0</span> categories
                </p>
            </div>
        </div>

        <!-- Admin Section -->
        <div class="card admin-section">
            <div class="admin-title">
                <i class="fas fa-user-shield"></i> Admin Functions
            </div>
            <div class="admin-buttons">
                <button class="admin-btn view" onclick="viewAllVotes()">
                    <i class="fas fa-chart-bar"></i> View All Votes
                </button>
                <button class="admin-btn reset" onclick="resetForNewVoter()">
                    <i class="fas fa-sync-alt"></i> New Voter
                </button>
                <button class="admin-btn clear" onclick="clearAllVotes()">
                    <i class="fas fa-trash-alt"></i> Clear All Votes
                </button>
                <button class="admin-btn view" onclick="downloadVotes()">
                    <i class="fas fa-download"></i> Download Votes
                </button>
                <button class="admin-btn view" onclick="testGoogleSheets()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ YOUR NEW GOOGLE APPS SCRIPT URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzdFj9dQcK2T8VObvQHFl3NNp-kj80_BmnQBDX4QXG2S-dY2e2tKCCzFAdwj0y5OLBVug/exec';

        // Award categories
        const awardCategories = [
            "ISU Executive Board Member of the Year",
            "Most Dedicated Volunteer",
            "Outstanding Cultural Event of the Year",
            "International Students Athletes of the Year (Football, Volleyball, Basketball)",
            "Art & Creative Award",
            "Best Teacher of the Year",
            "Most Talented Award",
            "Most Popular Award (Male)",
            "Most Popular Award (Female)",
            "Most Active Award",
            "Best Behavior Award",
            "Best Cleaning Room Award",
            "Best Coach Award",
            "Best Student dancing Award",
            "Best Photographer award",
            "Student MC of the Year",
            "Best Course REP of the Year (Male)",
            "Best Course REP of the Year (Female)",
            "Best Artist of the Year",
            "Student Entrepreneur of the year",
            "Outstanding graphic designer of the year",
            "Gentlemen of the Year",
            "Lady of the Year",
            "Most fashionable Student (Male)",
            "Most fashionable Student (Female)",
            "Social Media Influencer of the year",
            "Most influential Student of the Year",
            "Best sports personality of the year",
            "Best Student in Politics of the year",
            "Best ISU appointees",
            "ISU Excellent Award",
            "Most influential personality of Football, Basketball, and volleyball",
            "Class Football Team of the year",
            "Committee/ Department Head of the year",
            "Best Initiative Award",
            "Academic Excellent Award (Undergraduate)",
            "Academic Excellent Award (Graduate)",
            "International Office Appreciation Award"
        ];

        // COMPLETE CANDIDATE DATA - All 54 candidates from your Excel file
        const candidates = [
            { name: "EL-KHADIRI MERYEME", country: "Morocco", photo: "photos/EL-KHADIRI_MERYEME.jpg", positions: [0,8,17,20,30,35,37] },
            { name: "Michelle Okyerebea Asante", country: "GHANA", photo: "photos/Michelle_Okyerebea_Asante.jpg", positions: [1,8,9,10,11,19,22,25] },
            { name: "Kundayi Nigel Ndoro", country: "ZIMBABWE", photo: "photos/Kundayi_Nigel_Ndoro.jpg", positions: [12,27,31] },
            { name: "BERRADA SOUHAIL", country: "MOROCCO", photo: "photos/BERRADA_SOUHAIL.jpg", positions: [15,21,23] },
            { name: "NIGINA", country: "UZBEKISTAN", photo: "photos/NIGINA.jpg", positions: [6,8,10,24,25] },
            { name: "Zulfiddin Mehriddinov", country: "UZBEKISTAN", photo: "photos/Zulfiddin_Mehriddinov.jpg", positions: [3,31] },
            { name: "MUHAMMADOV MUHAMMAD SODIK", country: "UZBEKISTAN", photo: "photos/MUHAMMADOV_MUHAMMAD_SODIK.jpg", positions: [27,31] },
            { name: "Diaby Khadjaly", country: "GUINEA", photo: "photos/Diaby_Khadjaly.jpg", positions: [14,20,21,30] },
            { name: "Wisdom Chisom", country: "Nigeria", photo: "photos/Wisdom_Chisom.jpg", positions: [23] },
            { name: "Kra Kouassi Fedi", country: "Ivory Coast", photo: "photos/Kra_Kouassi_Fedi.jpg", positions: [31] },
            { name: "Izzatullaev Musulmon", country: "UZBEKISTAN", photo: "photos/Izzatullaev_Musulmon.jpg", positions: [1,9,10] },
            { name: "Watson Karanda", country: "ZIMBABWE", photo: "photos/Watson_Karanda.jpg", positions: [19] },
            { name: "Eze Victor", country: "Nigeria", photo: "photos/Eze_Victor.jpg", positions: [19,23] },
            { name: "Keita Fatumata S", country: "Liberia", photo: "photos/Keita_Fatumata_S.jpg", positions: [15] },
            { name: "Elma Taimu", country: "Zimbabwe", photo: "photos/Elma_Taimu.jpg", positions: [13] },
            { name: "Marygold Vimbainashe", country: "ZIMBABWE", photo: "photos/Marygold_Vimbainashe.jpg", positions: [3,31] },
            { name: "Khoshimov M", country: "UZBEKISTAN", photo: "photos/Khoshimov_M.jpg", positions: [27,31] },
            { name: "Anika Jannatul Ferdush", country: "BANGLADESH", photo: "photos/Anika_Jannatul_Ferdush.jpg", positions: [1,2,8,9,11,13,22,26,30,34] },
            { name: "Serhani Anass", country: "MOROCCO", photo: "photos/Serhani_Anass.jpg", positions: [3,27,31] },
            { name: "Andrew Stephen W", country: "CAMEROON", photo: "photos/Andrew_Stephen_W.jpg", positions: [3,27,31] },
            { name: "Matola Kenny Jerre", country: "South Africa", photo: "photos/Matola_Kenny_Jerre.jpg", positions: [3] },
            { name: "Karshygayeva Aiym", country: "KAZAKHSTAN", photo: "photos/Karshygayeva_Aiym.jpg", positions: [6,8,26,36] },
            { name: "Chatir Soukaina", country: "MOROCCO", photo: "photos/Chatir_Soukaina.jpg", positions: [11,22,27,35] },
            { name: "Duru Valentine Obinna", country: "Nigeria", photo: "photos/Duru_Valentine_Obinna.jpg", positions: [7] },
            { name: "Say Kong Tharak", country: "CAMBODIA", photo: "photos/Say_Kong_Tharak.jpg", positions: [2,11] },
            { name: "Ork Chanchutema", country: "CAMBODIA", photo: "photos/Ork_Chanchutema.jpg", positions: [10,36] },
            { name: "Kong Mengsean", country: "CAMBODIA", photo: "photos/Kong_Mengsean.jpg", positions: [2,8,9,35,37] },
            { name: "Clarmancio Nilton Silva Fernandes", country: "Mozambique", photo: "photos/Clarmancio_Nilton_Silva_Fernandes.jpg", positions: [3,27] },
            { name: "Fixa", country: "MOROCCO", photo: "photos/Fixa.jpg", positions: [25] },
            { name: "MAMAYUSUPOV ILKHOM", country: "Uzbekistan", photo: "photos/MAMAYUSUPOV_ILKHOM.jpg", positions: [27,31] },
            { name: "Shaun Nkosinathi NG", country: "South Africa", photo: "photos/Shaun_Nkosinathi_NG.jpg", positions: [18] },
            { name: "AIT BAHMED FOUZIA", country: "MOROCCO", photo: "photos/AIT_BAHMED_FOUZIA.jpg", positions: [5,6,10,12,22,27,35] },
            { name: "LUPAHLA SANELE", country: "Zimbabwe", photo: "photos/LUPAHLA_SANELE.jpg", positions: [3,8,9,11,27] },
            { name: "OFFOR UCHECHI ROSELINE", country: "Nigeria", photo: "photos/OFFOR_UCHECHI_ROSELINE.jpg", positions: [11] },
            { name: "OUSSOUSS HAMID", country: "MOROCCO", photo: "photos/OUSSOUSS_HAMID.jpg", positions: [2,6,14] },
            { name: "SOT FA ELIN", country: "CAMBODIA", photo: "photos/SOT_FA_ELIN.jpg", positions: [0,4,9,11,14,20,25,28,30] },
            { name: "ORA", country: "Rwanda", photo: "photos/ORA.jpg", positions: [11] },
            { name: "PHIRI EMMANUEL", country: "Zambia", photo: "photos/PHIRI_EMMANUEL.jpg", positions: [1,10,33] },
            { name: "COMPUTER SCIENCE", country: "", photo: "photos/COMPUTER_SCIENCE.jpg", positions: [32] },
            { name: "Mozumder Aktia Pableha", country: "BANGLADESH", photo: "photos/Mozumder_Aktia_Pableha.jpg", positions: [1] },
            { name: "Bekkaoui Souhaib", country: "Morocco", photo: "photos/Bekkaoui_Souhaib.jpg", positions: [4,13,23,28,34] },
            { name: "TOURE FRED RYAN", country: "Ivory Coast", photo: "photos/TOURE_FRED_RYAN.jpg", positions: [3,11,27,32] },
            { name: "KUNGNE KALEUK STEEVE JOSUE", country: "Cameroon", photo: "photos/KUNGNE_KALEUK_STEEVE_JOSUE.jpg", positions: [1,35] },
            { name: "Naphtali Antonio", country: "", photo: "photos/Naphtali_Antonio.jpg", positions: [14] },
            { name: "Magzhan", country: "Kazakhstan", photo: "photos/Magzhan.jpg", positions: [12,21] },
            { name: "Ahmed Qahtan", country: "Yemen", photo: "photos/Ahmed_Qahtan.jpg", positions: [21] },
            { name: "Takem Tchinda Saturnin", country: "Cameroon", photo: "photos/Takem_Tchinda_Saturnin.jpg", positions: [2,7,19] },
            { name: "KHALIL", country: "RUSSIA", photo: "photos/KHALIL.jpg", positions: [4,18] },
            { name: "Kadyrova Kadiya Demirovna", country: "Kyrgyzstan", photo: "photos/Kadyrova_Kadiya_Demirovna.jpg", positions: [8,10,22,24] },
            { name: "CHAFAI ASMA", country: "MOROCCO", photo: "photos/CHAFAI_ASMA.jpg", positions: [1] },
            { name: "ANTWI ABRAHAM FORJOUR", country: "Ghana", photo: "photos/ANTWI_ABRAHAM_FORJOUR.jpg", positions: [16] },
            { name: "Sherzat Shakirbaev", country: "Kyrgyzstan", photo: "photos/Sherzat_Shakirbaev.jpg", positions: [16,19,28] }
        ];

        let currentCategoryIndex = 0;
        let votes = {};
        let hasVoted = localStorage.getItem('hasVoted') === 'true';
        let googleSheetsConnected = false;

        // Initialize the voting system
        function init() {
            console.log("Voting system initialized!");
            loadCurrentCategory();
            
            // Load saved votes if any
            const savedVotes = localStorage.getItem('votes');
            if (savedVotes) {
                votes = JSON.parse(savedVotes);
                updateProgress();
            }

            // Test Google Sheets connection
            testGoogleSheets();
        }

        // Test Google Sheets connection
        async function testGoogleSheets() {
            const statusElement = document.getElementById('connectionStatus');
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                if (response.ok) {
                    googleSheetsConnected = true;
                    statusElement.textContent = 'GOOGLE SHEETS CONNECTED';
                    statusElement.className = 'status-badge status-online';
                    console.log('‚úÖ Google Sheets connection: SUCCESS');
                    
                    // Update button text
                    document.getElementById('submitButton').innerHTML = '<i class="fas fa-paper-plane"></i> Submit All Votes to Google Sheets';
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                googleSheetsConnected = false;
                statusElement.textContent = 'OFFLINE MODE';
                statusElement.className = 'status-badge status-offline';
                console.log('‚ùå Google Sheets connection: FAILED - Using offline mode');
                
                // Update button text
                document.getElementById('submitButton').innerHTML = '<i class="fas fa-paper-plane"></i> Submit All Votes (Offline)';
            }
        }

        // Load current category
        function loadCurrentCategory() {
            if (hasVoted) {
                showAlreadyVoted();
                return;
            }

            const container = document.getElementById('categoriesContainer');
            const category = awardCategories[currentCategoryIndex];
            
            const categoryCandidates = candidates.filter(candidate => 
                candidate.positions.includes(currentCategoryIndex)
            );

            // If no candidates in this category, skip to next
            if (categoryCandidates.length === 0) {
                if (currentCategoryIndex < awardCategories.length - 1) {
                    currentCategoryIndex++;
                    loadCurrentCategory();
                }
                return;
            }

            container.innerHTML = `
                <div class="category-title">${category}</div>
                <div class="category-description">
                    Select ONE winner from ${categoryCandidates.length} candidate(s)
                </div>
                
                <div class="candidates-grid">
                    ${categoryCandidates.map((candidate, index) => `
                        <div class="candidate-card" onclick="selectCandidate(${currentCategoryIndex}, '${candidate.name.replace(/'/g, "\\'")}')">
                            <img src="${candidate.photo}" alt="${candidate.name}" class="candidate-photo" 
                                 onerror="this.src='https://via.placeholder.com/120x120/3498db/white?text=Photo'">
                            <div class="candidate-name">${candidate.name}</div>
                            <div class="candidate-country">${candidate.country}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="navigation">
                    <button class="btn btn-primary" onclick="previousCategory()" ${currentCategoryIndex === 0 ? 'disabled' : ''}>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" onclick="nextCategory()">
                        ${currentCategoryIndex === awardCategories.length - 1 ? 'Finish' : 'Next'} <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;

            updateProgress();
            
            // Highlight any previously selected candidate
            if (votes[currentCategoryIndex]) {
                highlightSelectedCandidate(currentCategoryIndex, votes[currentCategoryIndex]);
            }
        }

        // Select candidate for category
        function selectCandidate(categoryIndex, candidateName) {
            votes[categoryIndex] = candidateName;
            highlightSelectedCandidate(categoryIndex, candidateName);
            updateProgress();
            saveVotes();
        }

        // Highlight selected candidate
        function highlightSelectedCandidate(categoryIndex, candidateName) {
            const cards = document.querySelectorAll('.candidate-card');
            cards.forEach(card => {
                card.classList.remove('selected');
                if (card.querySelector('.candidate-name').textContent === candidateName) {
                    card.classList.add('selected');
                }
            });
        }

        // Navigation functions
        function nextCategory() {
            if (currentCategoryIndex < awardCategories.length - 1) {
                currentCategoryIndex++;
                loadCurrentCategory();
            }
        }

        function previousCategory() {
            if (currentCategoryIndex > 0) {
                currentCategoryIndex--;
                loadCurrentCategory();
            }
        }

        // Update progress and submit section
        function updateProgress() {
            const votedCount = Object.keys(votes).length;
            const progress = (votedCount / awardCategories.length) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = 
                `Category ${currentCategoryIndex + 1} of ${awardCategories.length} ‚Ä¢ ${votedCount}/${awardCategories.length} voted`;
            
            updateSubmitSection();
        }

        // Update submit section visibility
        function updateSubmitSection() {
            const submitSection = document.getElementById('submitSection');
            const totalVotes = Object.keys(votes).length;
            
            if (totalVotes > 0 && !hasVoted) {
                submitSection.style.display = 'block';
            } else {
                submitSection.style.display = 'none';
            }
            
            document.getElementById('votesCount').textContent = totalVotes;
        }

        // Submit votes - SIMPLE VERSION (Works offline)
        async function submitVotes() {
            const totalVotes = Object.keys(votes).length;
            
            if (totalVotes === 0) {
                alert('Please vote in at least one category before submitting.');
                return;
            }

            // Show loading state
            const submitButton = document.getElementById('submitButton');
            submitButton.innerHTML = '<div class="loading"></div> Submitting...';
            submitButton.disabled = true;

            // Save the final votes locally (ALWAYS WORKS)
            const voteData = {
                timestamp: new Date().toISOString(),
                votes: votes,
                totalCategories: totalVotes,
                submittedAt: new Date().toLocaleString(),
                voterId: 'voter_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
            };
            localStorage.setItem('finalVotes', JSON.stringify(voteData));
            
            // Try to send to Google Sheets if connected
            if (googleSheetsConnected) {
                const success = await submitToGoogleSheets(voteData);
                if (success) {
                    alert(`‚úÖ SUCCESS! ${totalVotes} votes submitted to Google Sheets!\n\nYou can check your Google Sheet to see the data.`);
                } else {
                    alert(`‚úÖ SUCCESS! ${totalVotes} votes submitted locally!\n\n(Google Sheets connection failed - but votes are saved locally)`);
                }
            } else {
                // Show success message for offline mode
                alert(`‚úÖ SUCCESS! ${totalVotes} votes submitted locally!\n\nVotes are saved on this device.`);
            }
            
            hasVoted = true;
            localStorage.setItem('hasVoted', 'true');
            showAlreadyVoted();
        }

        // Try to submit to Google Sheets (optional)
        async function submitToGoogleSheets(voteData) {
            try {
                // Format data for Google Sheets - SIMPLE FORMAT
                const sheetsData = {
                    voterId: voteData.voterId,
                    timestamp: voteData.timestamp,
                    totalVotes: voteData.totalCategories,
                    votes: JSON.stringify(voteData.votes),
                    categories: awardCategories.join(' | ')
                };

                console.log('Sending to Google Sheets:', sheetsData);

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(sheetsData)
                });

                console.log('Google Sheets response status:', response.status);
                const result = await response.text();
                console.log('Google Sheets response:', result);

                return response.ok;
            } catch (error) {
                console.error('Google Sheets error:', error);
                return false;
            }
        }

        // Show already voted message
        function showAlreadyVoted() {
            document.getElementById('categoriesContainer').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-check-circle" style="font-size: 4rem; color: #27ae60; margin-bottom: 20px;"></i>
                    <h2 style="color: #27ae60;">Thank You For Voting!</h2>
                    <p style="font-size: 1.2rem; margin-top: 10px;">You have successfully submitted your votes.</p>
                    <p style="margin-top: 10px; color: #7f8c8d;">
                        ${googleSheetsConnected ? '‚úÖ Votes saved to Google Sheets' : 'üì± Votes saved locally (offline mode)'}
                    </p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">
                        You voted in ${Object.keys(votes).length} categories
                    </p>
                </div>
            `;
            document.getElementById('submitSection').style.display = 'none';
        }

        // Save votes to localStorage
        function saveVotes() {
            localStorage.setItem('votes', JSON.stringify(votes));
        }

        // Admin Functions
        function viewAllVotes() {
            const voteData = JSON.parse(localStorage.getItem('finalVotes') || '{}');
            if (!voteData.votes) {
                alert('No votes submitted yet.');
                return;
            }
            
            let results = 'YOUR SUBMITTED VOTES:\n\n';
            Object.entries(voteData.votes).forEach(([categoryIndex, candidate]) => {
                results += `‚Ä¢ ${awardCategories[categoryIndex]}: ${candidate}\n`;
            });
            
            results += `\nüìä Total Categories: ${voteData.totalCategories}`;
            results += `\n‚è∞ Submitted: ${voteData.submittedAt || voteData.timestamp}`;
            results += `\nüåê Status: ${googleSheetsConnected ? 'Connected to Google Sheets' : 'Offline Mode'}`;
            
            alert(results);
        }

        function resetForNewVoter() {
            if (confirm('Start new voting session? This will clear current votes.')) {
                votes = {};
                currentCategoryIndex = 0;
                hasVoted = false;
                localStorage.removeItem('hasVoted');
                localStorage.removeItem('votes');
                updateProgress();
                loadCurrentCategory();
                alert('‚úÖ Ready for new voter! Previous votes cleared.');
            }
        }

        function clearAllVotes() {
            if (confirm('Are you sure you want to clear ALL votes? This action cannot be undone.')) {
                votes = {};
                localStorage.removeItem('votes');
                localStorage.removeItem('finalVotes');
                updateProgress();
                loadCurrentCategory();
                alert('All votes have been cleared.');
            }
        }

        function downloadVotes() {
            const voteData = JSON.parse(localStorage.getItem('finalVotes') || '{}');
            if (!voteData.votes) {
                alert('No votes to download.');
                return;
            }
            
            const dataStr = JSON.stringify(voteData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'isu_votes.json';
            link.click();
        }

        // Start the application
        window.onload = init;
    </script>
</body>
</html>



